define(["jquery","shim!modules/jquery-simple-datetimepicker[jquery=jquery]>jquery"],function(t){var i=function(){var i=this;this.handler=t("#mz-date-display"),this.displayBar=t("#mz-date-display-cover"),this.urlBar=t("#mz-url-copy"),this.dateField=t(".visible-date"),this.setQueryString(this.getCookie(),!0),this.showUrl(),this.options={autodateOnStart:!0,currentTime:this.getCookie(),futureOnly:!0,onInit:function(t){i.picker=t,i.setDate(i.getCookie())}}},e=function(i){this.handler=t(i),this.urlBar=t("#mz-url-copy")},n=function(){e.apply(this,arguments),this.headerbar=t(".mz-future-date-header"),this.indicator=t(".mz-future-bar-indicator"),this.isShown=function(){if(document.cookie.split(";").filter(function(t){return t.indexOf("MZ_SHOW_FUTURE_BAR")>0})){var t=document.cookie.split(";").filter(function(t){return t.indexOf("MZ_SHOW_FUTURE_BAR")>0})[0];return t?-1!==t.indexOf("true"):!0}return!0}()},o=function(){e.apply(this,arguments)},r=function(){var i=this;this.handler=t("#mz-pricelist-display"),this.handler.blur(function(){i.setQueryString(this.value)}),this.handler.keypress(function(t){var e=13;t.which===e&&i.setQueryString(this.value)})},s=function(t){if(!t||0===t.length)return"";var i=t;return"&"===t.substring(0,1)&&(i="?"+t.substring(1)),i=i.replace(/(&)+/g,"&"),i=i.replace(/(\?)+/g,"?"),i=i.replace(/(\?&)/g,"?"),"&"===i.substring(i.length-1)&&(i=i.substring(0,i.length-1)),i};o.prototype=new e,n.prototype=new e,n.prototype.init=function(){this.handler.on("click",this.action.bind(this)),this.indicator.on("click",this.action.bind(this))},n.prototype.action=function(){this.indicator.toggleClass("hidden"),this.headerbar.toggleClass("mz-header-hidden"),this.setIsShown(),t(document).find(".datepicker").hide(),this.setCookie()},n.prototype.setIsShown=function(){this.isShown=!this.isShown},n.prototype.setCookie=function(){document.cookie=" MZ_SHOW_FUTURE_BAR="+this.isShown+"; Path=/; Expires="},i.prototype.init=function(){this.plugin=this.handler.appendDtpicker(this.options),this.displayBar.on("click",function(){this.picker.show()}.bind(this)),t(document).on("click",function(t){-1===t.target.className.indexOf("pricelist")&&(this.picker.isShow()||this.dateHasChanged.call(this)&&(location.search=this.getQueryString(this.sanitizeDate())))}.bind(this)),this.handler.on("change",function(){this.changedValue=!0}.bind(this)),t(document).on("click",".icon-home",this.setCookie.bind(this))},i.prototype.sanitizeDate=function(){return new Date(this.plugin.val().replace(/-/g,"/")).toISOString()},i.prototype.setDate=function(t){t=t?new Date(t).toDateString()+", "+new Date(t).toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})+" CST":"Now",this.dateField.text(t)},i.prototype.getCookie=function(){var t=document.cookie.split(";").filter(function(t){return t.indexOf("MZ_NOW")>0});return t.length>0?t[0].replace(" MZ_NOW=",""):""},i.prototype.setCookie=function(){var t=new Date;t.setDate(t.getDate()-1),document.cookie=" MZ_NOW=; Path=/; Expires="+t,location.search=""},i.prototype.setQueryString=function(t,i){i&&t&&window.history.replaceState("MOZU",document.title,this.getQueryString(t))},i.prototype.sanitizeQueryString=s,i.prototype.getQueryString=function(t){var i="";return location.search.match("mz_now="+t)?location.search:(-1!==location.search.indexOf("?")&&-1===location.search.indexOf("mz_now")?i=location.search+"&mz_now="+t:-1!==location.search.indexOf("?")?(i=location.search.replace(/[&?]*mz_now[^&]*/gi,""),0===i.length?i="?":i.length>1&&(i+="&"),i+="mz_now="+t):i="?mz_now="+t,this.sanitizeQueryString(i))},i.prototype.dateHasChanged=function(){return""===window.location.search&&this.changedValue?!0:""!==window.location.search?this.sanitizeDate().substring(0,23)!==this.getCookie().substring(0,23):void 0},i.prototype.showUrl=function(){this.urlBar.val(location.href),this.urlBar.on("click",function(){t(this).select()})},r.prototype.init=function(){this.handler.on("change",function(){this.changedValue=!0}.bind(this))},r.prototype.getQueryStringValue=function(){var t=/mz_pricelist=(.*?)(?:&.*|$)/gi,i=t.exec(location.search);return i&&i.length>=1?i[1]:""},r.prototype.setQueryString=function(t){var i=location.search,e=this.getQueryStringValue();t!==e&&(t?-1===location.search.indexOf("mz_pricelist")?(i+=-1!==i.indexOf("?")?"&":"?",i+="mz_pricelist="+t):i=i.replace("mz_pricelist="+e,"mz_pricelist="+t):i=i.replace("mz_pricelist="+e,""),location.search=this.sanitizeQueryString(i))},r.prototype.sanitizeQueryString=s,o.prototype.init=function(){this.handler.on("click",function(){this.urlBar.select()}.bind(this))};var a=new i,c=new n("#mz-showhide-preview-bar"),h=new o("#mz-share"),u=new r;a.init(),c.init(),h.init(),u.init()});