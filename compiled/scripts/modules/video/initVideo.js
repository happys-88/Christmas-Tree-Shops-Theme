define(["modules/jquery-mozu","modules/backbone-mozu","hyprlive","modules/models-product","underscore"],function(e,o,i,d,t){e(function(){function o(o){var n=!!document.location.pathname.match(/\/mobile/),a=d.Product.fromCurrent(),r=t.findWhere(a.get("properties"),{attributeFQN:"tenant~Video_Id"}),l=r.values[0].stringValue,s={},c=require.mozuData("pagecontext");if(n){var v=e("<div/>",{id:"invodoovl"}).css({width:"100%",height:"100%",position:"fixed",top:0,background:"url(/images/misc/black50.png)",zIndex:1e3}).hide().appendTo("#container").click(function(o){return null!==o.target.id.match(/videoClose|invodoovl/)?(s.currTime=s.invodoWidget.getTime(),s.invodoWidget.pause(),e(this).hide(),!1):void 0});v.html('<div id="videoClose" style="background:#fff; padding: 1px;"><div id="videoClose2" style="margin: 0 0 0 auto; padding: 5px; border: 1px solid #999999; width: 1em; height: 1em; line-height: 1em; text-align: center; color: #999999; text-transform: uppercase;" style="cursor: pointer;"><span id="videoClose3">x</span></div></div>');var p=e("<div/>",{id:i}).css({height:"100%",width:"100%"}).appendTo(v);e(o).click(function(){e(document).scrollTop(0),e("#invodoovl").show();var o=e(window).height(),i=e(window).width(),d=i>o;d&&e("#videoClose").css({opacity:.7,position:"absolute",zIndex:50,right:0});var t=d?16*o/9:i,n=d?o:9*i/16;p.css({width:t,height:n});try{s.invodoWidget.play()}catch(a){}})}else s=e('<div id="'+i+'" class="modal video-container"> <div id="toprightclose" class="closebutton" data-dismiss="modal" aria-hidden="true" style="z-index: 10003;"></div></div>'),e("body").append(s),s.preunpopcallback=function(){s.currTime=s.invodoWidget.getTime(),s.invodoWidget.pause()},s.postpopcallback=function(){try{s.invodoWidget.play()}catch(e){}},e(o).click(function(){return e("#videoOverlay").removeClass("video-overlay"),e("#playButton").removeClass("play-button-main"),s.modal("show"),e("#videoContainer").css("display","block"),c.isTablet&&e("body").addClass("video-scroll-bg"),s.invodoWidget.play(),!1}),e("#toprightclose").click(function(){s.currTime=s.invodoWidget.getTime(),c.isTablet&&e("body").removeClass("video-scroll-bg"),s.invodoWidget.pause()});s.currTime=0,"undefined"!=typeof Invodo&&l.length>0&&Invodo.init({pageName:e(o).attr("data-pagename"),pageType:"product",affiliate:{chromelessmode:"false",bgcolor:"FFFFFF",loadingviewcolor:"1B9990",showPlayButton:"false"},onload:function(){s.videoType=Invodo.getAffiliateConfig().videoPlayerPreference;var d=function(){return"undefined"!=typeof s.videoType?"Flash"==s.videoType:!1}(),t=Invodo.Widget.add({mpd:l,widgetId:"PDPplayer",mode:"embedded",type:"inplayer",autoplay:d,parentDomId:i,onpodload:function(){Invodo.Widget.add({widgetId:"videoThumbnail",type:"cta",mpd:l,data:o}),e(o).show()}}).registerEventListener("videoStart",function(){s.currTime&&(s.invodoWidget.setTime(s.currTime),s.currTime=0)});window.invodo=s.invodoWidget=t}})}var i="videoContainer",n=e(".video-image-position")[0];n&&o(n)})});