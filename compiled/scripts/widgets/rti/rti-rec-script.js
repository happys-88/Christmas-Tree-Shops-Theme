require(["modules/jquery-mozu","hyprlive","hyprlivecontext","underscore","modules/api","modules/backbone-mozu","modules/models-product","widgets/rti/recommended-products","widgets/rti/gc-recommended-products","bxslider"],function(e,t,r,d,o,n,i,c,a){function s(){if(e("#global-cart .recommended-product-container").length)try{var t=a.getInstance(T);t.getProductData(function(e){I(e)})}catch(r){}}var l,u=e(".recommended-product-container").not("#global-cart .recommended-product-container").first(),m={};e(".recommended-product-container").not("#global-cart .recommended-product-container").length&&(l=u.data("mzRtiRecommendedProducts"),m={customerId:l.customerId||"",customerCode:l.customerCode||"",pageType:l.pageType||"",jsInject:l.javascriptInjection||"",includeSiteId:l.includeSiteId||!1,includeTenantId:l.includeTenantId||!1});var p=require.mozuData("pagecontext"),f=(require.mozuData("sitecontext"),[]);e(".recommended-product-container").not("#global-cart .recommended-product-container").each(function(){if(!e(this).hasClass("ignore")){var t=e(this).data("mzRtiRecommendedProducts"),r={title:t.title||"",quantity:t.numberOfItems||"",format:t.displayType||"",placeholder:t.placeholder||""},d={config:r},o=".recommended-product-container."+t.placeholder;e(o).not("#global-cart .recommended-product-container").length>1&&e(o).not("#global-cart .recommended-product-container").each(function(t,r){t>0&&(e(r).removeClass(),e(r).addClass("ignore"),p.isEditMode&&e("<p>Error: duplicate placeholder name.</p>").insertBefore(e(r)),e(r).hide())}),f.push(d)}});var g=(n.MozuModel.extend({mozuType:"products"}),n.MozuView.extend({templateName:"modules/product/rti-product-list"})),h=function(e){for(var t=o.defer(),r=e.length,n=[],i="",c=0;r>c;c++)e[c].ProductCode&&!e[c].ProductId&&(e[c].ProductId=e[c].ProductCode);d.each(e,function(e){""!==i&&(i+=" or "),i+="productCode eq "+e.ProductId});var a=o.get("products",i);return a.then(function(r){d.each(r.data.items,function(r){var o=d.findWhere(e,{ProductId:r.productCode});r.rtiRank=o.rank||"",r.slot=o.slot||"",r.widgetId=o.widgetId||"",r.href=o.url||"",n.push(r),d.defer(function(){t.resolve(n)})})},function(){d.defer(function(){t.resolve(n)})}),t.promise},v=function(t){d.each(f,function(r){var o=r.config.placeholder,n=r.config.quantity||r.config.numberOfItems,c=r.config.title,a=r.config.format;if(p.isEditMode)return e(".recommended-product-container."+o).text("<b>Here Goes your RTI Recommended items</b>"),void 0;var s=e.grep(t,function(e){return e.placeholderName==o});if(s[0]){var l;l=c?c:s[0].displayName;var u;u=s[0].productList.length>n?s[0].productList.slice(0,n):s[0].productList,h(u).then(function(r){if(0!==r.length){var n=d.sortBy(r,"rtiRank");u=n;var c=new i.ProductCollection;if(c.set("items",u),c.set("bnData",t.bnData),s[0].editModeMessage)p.isEditMode&&e(".recommended-product-container."+o).text(s[0].editModeMessage);else if(e("."+o+".slider-title span").text(l),a||(a="carousel"),"carousel"==a){var m=new g({el:e("."+o+".rti-recommended-products"),model:c});return m.render(),u.length>1?e("."+o+".rti-recommended-products .bxslider").bxSlider({minSlides:2,maxSlides:3,slideWidth:260,slideMargin:60,nextText:'<i class="fa fa-angle-right" aria-hidden="true"></i>',prevText:'<i class="fa fa-angle-left" aria-hidden="true"></i>',responsive:!0,pager:!1,speed:0,infiniteLoop:!1,hideControlOnEnd:!0}):1===u.length&&e("[data-mz-product]").find("img").addClass("single-img-width"),0===u.length&&e("."+o+".recommended-product-container").hide(),void 0}}else p.isEditMode&&e(".recommended-product-container."+o).text("There was a problem retrieving products from your catalog that match the products received from RTI.")})}else p.isEditMode&&e(".recommended-product-container."+o).text("Placeholder not found.")})},I=function(t){e("#global-cart .recommended-product-container").each(function(){var r=e(this),o=M.placeholder,n=M.quantity||M.numberOfItems,c=M.title,a=M.format;if(p.isEditMode)return r.text("<b>Here Goes your RTI Recommended items</b>"),void 0;var s=e.grep(t,function(e){return e.placeholderName==o});if(s[0]){var l;l=c?c:s[0].displayName;var u;u=s[0].productList.length>n?s[0].productList.slice(0,n):s[0].productList,h(u).then(function(e){if(0!==e.length){var o=d.sortBy(e,"rtiRank");u=o;var n=new i.ProductCollection;if(n.set("items",u),n.set("bnData",t.bnData),s[0].editModeMessage)p.isEditMode&&r.text(s[0].editModeMessage);else if(r.find(".slider-title span").text(l),a||(a="carousel"),"carousel"==a){var c=new g({el:r.find(".rti-recommended-products"),model:n});try{r.find(".rti-recommended-products .bxslider").destroySlider()}catch(m){}return c.render(),u.length>1&&r.find(".rti-recommended-products .bxslider").bxSlider({minSlides:3,maxSlides:3,slideWidth:150,slideMargin:5,nextText:'<i class="fa fa-angle-right" aria-hidden="true"></i>',prevText:'<i class="fa fa-angle-left" aria-hidden="true"></i>',responsive:!0,pager:!1,speed:0,infiniteLoop:!1,hideControlOnEnd:!0}),0===u.length&&r.find(".recommended-product-container").hide(),void 0}}else p.isEditMode&&r.text("There was a problem retrieving products from your catalog that match the products received from RTI.")})}else p.isEditMode&&r.text("Placeholder not found.")})};try{if(e(".recommended-product-container").not("#global-cart .recommended-product-container").length){var b=c.getInstance(m);b.getProductData(function(e){v(e)})}}catch(x){}var y,M,T;e("#global-cart .recommended-product-container").length&&(y=e("#global-cart .recommended-product-container").first(),M=y.data("mzRtiRecommendedProducts"),T={customerId:M.customerId||"",customerCode:M.customerCode||"",pageType:M.pageType||"",jsInject:M.javascriptInjection||"",includeSiteId:M.includeSiteId||!1,includeTenantId:M.includeTenantId||!1}),window.updateGCRTI=s});