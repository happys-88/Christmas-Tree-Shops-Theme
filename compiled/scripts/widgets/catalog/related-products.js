require(["modules/jquery-mozu","underscore","modules/api","modules/backbone-mozu","modules/models-product","shim!vendor/jquery/owl.carousel.min"],function(t,e,i,a,o){var r=function(t){return!!t},n=0,s=function(t){var a=e.map(t,function(t){return"ProductCode eq "+t}).join(" or "),o=i.get("search",{filter:a,sortBy:"tenant~rating desc"});return o},c=a.MozuModel.extend({mozuType:"products"}),d=require.mozuData("pagecontext"),l=function(t,e){s(t).then(function(i){var a=null;a=t.length>0?new o.ProductCollection(i.data):new o.ProductCollection;var r=new p({model:a,el:e});r.render()})},u=a.MozuView.extend({additionalEvents:{"click .next":"next","click .previous":"previous","click [data-mz-swatch]":"colorSwatching","click a.wishlist-button":"addToWishlist","touchstart a.wishlist-button":"addToWishlist"},initialize:function(){this.owl=null;var t=this,e=require.mozuData("user").isAnonymous;e===!1&&t.addedToWishlist()},getMaxHeight:function(e){return Math.max.apply(null,t(e).map(function(){return t(this).height()}).get())},manageBlocksHeight:function(){try{{var e=this;t(e.el).find(".mz-productlisting"),t(e.el).find(".mz-productlisting-info"),t(e.el).find(".mz-subcategory-image-div"),t(e.el).find(".mz-category-price")}}catch(i){}},moveTitle:function(){var e=this;t(e.el).find(".title").html(t(e.el).parent().find(".slider-title").html())},colorSwatching:function(i){if(i.preventDefault(),0===n){n=1;var a=t(i.currentTarget);a.closest(".owl-item").find("input").css({border:"none"}),a.css({border:"2px solid #4a4a4a"});{var o=a.closest(".mz-productlisting").data("mz-product"),r=a.attr("value").toLowerCase(),s=a.attr("value"),d=a.closest(".mz-productlisting").find(".mz-subcategory-image").attr("data-main-image-src");window.location.origin}a.closest(".mz-productlisting").find(".mz-subcategory-image").removeClass("active"),a.closest(".mz-productlisting").find(".mainImageContainer2").addClass("active");var l=new c;l.set("filter","productCode eq "+o),l.fetch().then(function(t){var i=t.apiModel.data.items,o=null,c=null;if(e.each(i,function(t){o=e.findWhere(t.content.productImages,{altText:s||r})}),o){var l=o.imageUrl;a.closest(".mz-productlisting").find(".mz-subcategory-image").attr({srcset:l+"?max=400",alt:c,style:""}).addClass("active"),a.closest(".mz-productlisting").find(".mainImageContainer2").removeClass("active"),n=0}else a.closest(".mz-productlisting").find(".mz-subcategory-image").attr({srcset:d+"?max=400",style:""}).addClass("active"),a.closest(".mz-productlisting").find(".mainImageContainer2").removeClass("active"),n=0})}},addToWishlist:function(e){e.preventDefault();var a=t(e.currentTarget).data("listing-prod-code"),r=e.currentTarget;t(r).hasClass("addedToWishlist")||t(r).addClass("clicked");i.createSync("wishlist").getOrCreate(require.mozuData("user").accountId).then(function(t){return t.data}).then(function(e){for(var i=!0,n=0;n<e.items.length;n++)e.items[n].product.productCode==a&&(i=!1);if(i){var s=new o.Product({productCode:a});s.addToWishlist({quantity:1});try{s.on("addedtowishlist",function(){t(document).trigger("productAddedToWishlist"),t(r).attr("disabled","disabled"),t(r).addClass("addedToWishlist")})}catch(c){}}})},addedToWishlist:function(){var e=[],a=[],o=0;t(".mz-productlisting").each(function(){var i=t(this).find("a.wishlist-button"),r=t(this).data("mz-product");e[o]=r,a[o]=i,o++});var r=require.mozuData("user").isAnonymous;if(r===!1){i.createSync("wishlist").getOrCreate(require.mozuData("user").accountId).then(function(t){return t.data}).then(function(i){for(var o=0;o<e.length;o++)for(var r=0;r<i.items.length;r++)i.items[r].product.productCode==e[o]&&(t(a[o]).prop("disabled","disabled"),t(a[o]).addClass("addedToWishlist"))})}},render:function(){function e(e,i){var a=t(e).owlCarousel({loop:!1,responsiveClass:!0,width:"100%",responsive:{0:{items:2,nav:!1},480:{items:3,nav:!1},1025:{items:6,nav:!1}}});a.on("changed.owl.carousel",function(e){e.item.index>=1?t(i).find(".previous").show():t(i).find(".previous").hide(),e.item.index===e.item.count-s?t(i).find(".next").hide():t(i).find(".next").show()}),a.find(".owl-item").length<=s&&t(i).find(".next").hide(),t(".ig-related-products").css("visibility","visible"),t(".related-prod-owl-carousel #owl-example > .owl-item").addClass("mz-productlist-item"),t(i+" .next").on("click",function(){a.trigger("next.owl.carousel")}),t(i+" .previous").on("click",function(){a.trigger("prev.owl.carousel")}),t(i+" .next").on("click",function(){a.trigger("next.owl.carousel")}),t(i+" .previous").on("click",function(){a.trigger("prev.owl.carousel")});var o=t("#cross-sale-container .owl-item").length;(d.isDesktop&&o>=6||d.isTablet&&o>=3||d.isMobile&&o>=2)&&t("#cross-sale-container .ig-related-products").css("border-right","none");var r=t("#up-sale-container .owl-item").length;(d.isDesktop&&r>=6||d.isTablet&&r>=3||d.isMobile&&r>=2)&&t("#up-sale-container .ig-related-products").css("border-right","none")}var i=this;a.MozuView.prototype.render.apply(this,arguments);var o=t(i.el).find(".mz-subcategory-image-div img"),r=o.length,n=0;o.load(function(){n++,n==r&&i.manageBlocksHeight()}),t(".ig-related-products").find(".related-prod-owl-carousel").closest(".test").find(".related-container").removeClass("hidden");var s=1;d.isDesktop?s=6:d.isTablet?s=3:d.isMobile&&(s=2),e("#cross-sale-container .ig-related-products #owl-example","#cross-sale-container .ig-related-products"),e("#up-sale-container .ig-related-products #owl-example","#up-sale-container .ig-related-products"),t(".mz-price").each(function(){var e=t(this).data("total-amount"),i=e.toString(),a=i.charAt(0),o=i.split(a),r=o[1].split("."),n=r[1];"00"==n?t(this).html('<span class="dollar">'+a+"</span>"+r[0]):t(this).html('<span class="dollar">'+a+'</span><span class="interger">'+r[0]+"</span><sup>"+r[1]+"</sup>")}),i.moveTitle(),i.manageBlocksHeight();var c=require.mozuData("user").isAnonymous;c===!1&&i.addedToWishlist()}}),p=u.extend({templateName:"modules/product/related-product-tiles"});t(document).ready(function(){function a(){t("[data-ig-related-products]").each(function(a,n){n=t(n);var s=n.data("igRelatedProducts"),c=s.attributeId||"tenant~product-crosssell",d=(s.title,[]),u=[];e.each(o,function(a){"string"==typeof a&&(a=a.trim()),u.push(i.get("product",a).then(function(i){e.each(i.data.properties,function(i){if(i.attributeFQN==c){var a=e.pluck(i.values,"value");d=d.concat(t.grep(a||[],r))}})}))}),i.steps(u).then(function(){},function(){}).ensure(function(){l(d,n)})})}var o=[];switch(d.pageType){case"product":o.push(require.mozuData("product").productCode);break;case"cart":var n=require.mozuData("cart").items;t.each(n,function(t,e){o.push(e.product.productCode)}),t(document).on("cartChanged",function(){a()});break;default:var s=t("[data-ig-related-product-codes]").data("ig-related-product-codes");o=s.split(",")}a()})});