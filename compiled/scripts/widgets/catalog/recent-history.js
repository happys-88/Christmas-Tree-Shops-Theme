define(["modules/jquery-mozu","underscore","modules/backbone-mozu","hyprlive","modules/models-product","modules/api","hyprlivecontext","shim!vendor/jquery/owl.carousel.min","bootstrap"],function(t,e,i,o,s,r){var n=0,a=require.mozuData("pagecontext"),d=(i.MozuModel.extend({mozuType:"products"}),i.MozuModel.extend({mozuType:"products"})),c=(t("[data-ig-recent-history]").data("ig-recent-history"),i.MozuView.extend({templateName:"modules/product/related-product-tiles",additionalEvents:{"click .next":"next","click .previous":"previous","click [data-mz-swatch]":"colorRecentSwatching","click a.wishlist-button":"addToWishlist","touchstart a.wishlist-button":"addToWishlist"},initialize:function(){var t=this,e=require.mozuData("user").isAnonymous;this.owlSLider(),e===!1&&t.addedToWishlist()},owlSLider:function(){var e=1;e=a.isDesktop?6:a.isTablet?3:1;var i=t(".ig-recent-history .related-prod-owl-carousel").owlCarousel({loop:!1,responsiveClass:!0,responsive:{0:{items:2,nav:!1},480:{items:3,nav:!1},1025:{items:6,nav:!1}}});i.on("changed.owl.carousel",function(i){i.item.index>=1?t(".ig-recent-history").find(".previous").show():t(".ig-recent-history").find(".previous").hide(),i.item.index===i.item.count-e?t(".ig-recent-history").find(".next").hide():t(".ig-recent-history").find(".next").show()}),i.find(".owl-item").length<=e&&t(".ig-recent-history").find(".next").hide(),t(".ig-recent-history #owl-example > .owl-item").addClass("mz-productlist-item"),t(".ig-recent-history .next").on("click",function(){i.trigger("next.owl.carousel")}),t(".ig-recent-history .previous").on("click",function(){i.trigger("prev.owl.carousel")}),t(".cross-sell-title").removeClass("hidden");var o=t("#recent-history-main-content .owl-item").length;a.isDesktop&&o>=6&&t("#recent-history-main-content .ig-recent-history").css("border-right","none"),a.isTablet&&o>=3&&t("#recent-history-main-content .ig-recent-history").css("border-right","none"),a.isMobile&&o>=2&&t("#recent-history-main-content .ig-recent-history").css("border-right","none")},render:function(){var e=this;i.MozuView.prototype.render.apply(this,arguments),this.priceFunction();t(".ig-recent-history").find(".related-prod-owl-carousel").closest(".test").find(".recent-history-container").removeClass("hidden"),t('[data-toolstip="toolstip"]').tooltip(),this.owlSLider();var o=require.mozuData("user").isAnonymous;o===!1&&e.addedToWishlist()},colorRecentSwatching:function(i){if(i.preventDefault(),0===n){n=1;var o=t(i.currentTarget);o.closest(".owl-item").find("input").css({border:"none"}),o.css({border:"2px solid #4a4a4a"});{var s=o.closest(".mz-productlisting").data("mz-product"),r=o.attr("value").toLowerCase(),a=o.attr("value"),c=o.closest(".mz-productlisting").find(".mz-subcategory-image").attr("data-main-image-src");window.location.origin}o.closest(".mz-productlisting").find(".mz-subcategory-image").removeClass("active"),o.closest(".mz-productlisting").find(".mainImageContainer2").addClass("active");var l=new d;l.set("filter","productCode eq "+s),l.fetch().then(function(t){var i=t.apiModel.data.items,s=null,d=null;if(e.each(i,function(t){s=e.findWhere(t.content.productImages,{altText:a||r})}),s){var l=s.imageUrl;o.closest(".mz-productlisting").find(".mz-subcategory-image").attr({srcset:l+"?max=400",alt:d,style:""}).addClass("active"),o.closest(".mz-productlisting").find(".mainImageContainer2").removeClass("active"),n=0}else o.closest(".mz-productlisting").find(".mz-subcategory-image").attr({srcset:c+"?max=400",style:""}).addClass("active"),o.closest(".mz-productlisting").find(".mainImageContainer2").removeClass("active"),n=0})}},addToWishlist:function(e){e.preventDefault();var i=t(e.currentTarget).data("listing-prod-code"),o=e.currentTarget;t(o).hasClass("addedToWishlist")||t(o).addClass("clicked");r.createSync("wishlist").getOrCreate(require.mozuData("user").accountId).then(function(t){return t.data}).then(function(e){for(var r=!0,n=0;n<e.items.length;n++)e.items[n].product.productCode==i&&(r=!1);if(r){var a=new s.Product({productCode:i});a.addToWishlist({quantity:1});try{a.on("addedtowishlist",function(){t(document).trigger("productAddedToWishlist"),t(o).attr("disabled","disabled"),t(o).addClass("addedToWishlist")})}catch(d){}}})},addedToWishlist:function(){var e=[],i=[],o=0;t(".mz-productlisting").each(function(){var s=t(this).find("a.wishlist-button"),r=t(this).data("mz-product");e[o]=r,i[o]=s,o++});var s=require.mozuData("user").isAnonymous;if(s===!1){r.createSync("wishlist").getOrCreate(require.mozuData("user").accountId).then(function(t){return t.data}).then(function(o){for(var s=0;s<e.length;s++)for(var r=0;r<o.items.length;r++)o.items[r].product.productCode==e[s]&&(t(i[s]).prop("disabled","disabled"),t(i[s]).addClass("addedToWishlist"))})}},moveTitle:function(e){t(".popular-product-container .slider-title").text(o.getLabel("topSelling")+" "+e),t(".popular-product-container .slider-title").removeClass("hidden")},priceFunction:function(){t(".mz-price").each(function(){var e=t(this).data("total-amount"),i=e.toString(),o=i.charAt(0),s=i.split(o),r=s[1].split("."),n=r[1];"00"==n?t(this).html('<span class="dollar">'+o+"</span>"+r[0]):t(this).html('<span class="dollar">'+o+'</span><span class="interger">'+r[0]+"</span><sup>"+r[1]+"</sup>")})}}));return{recentHistroryView:c}});