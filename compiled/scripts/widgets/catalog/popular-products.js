require(["modules/jquery-mozu","underscore","modules/backbone-mozu","hyprlive","modules/models-product","modules/models-cart","modules/cart-monitor","modules/api","hyprlivecontext","shim!vendor/jquery/owl.carousel.min","bootstrap"],function(t,e,o,a,i,s,r,n,l){var d=0,c=require.mozuData("pagecontext"),u=(o.MozuModel.extend({mozuType:"products"}),o.MozuModel.extend({mozuType:"products"})),p=t("[data-ig-popular-products]").data("ig-popular-products"),m=(l.locals.themeSettings.newItemsToShow,l.locals.themeSettings.onSaleItemsToShow,o.MozuView.extend({templateName:"modules/product/related-product-tiles",additionalEvents:{"click .next":"next","click .previous":"previous","click [data-mz-swatch]":"colorSwatching","click a.wishlist-button":"addToWishlist","touchstart a.wishlist-button":"addToWishlist"},initialize:function(){this.owl=null;var t=this,e=require.mozuData("user").isAnonymous;e===!1&&t.addedToWishlist()},colorSelected:function(){var o=t(".ig-popular-products #owl-example .owl-stage-outer .owl-stage .owl-item");t(o).each(function(){var o,a=this,i=[],s=t(this).find("[data-main-image-src]").attr("alt");s&&(o=s.toString().toLowerCase()),t(this).find("[data-mz-swatch]").each(function(){var e=t(this).val();if(e){var o=e.toString().toLowerCase();i.push(o)}}),e.each(i,function(e){o===e&&t(a).find("[data-mz-swatch]").each(function(){var e=this;t(this).hasClass(o)&&t(e).css({border:"2px solid #4a4a4a"})})})})},render:function(){var e=1;e=c.isDesktop?6:c.isTablet?3:1,o.MozuView.prototype.render.apply(this,arguments),this.colorSwatching(),this.priceFunction();t('[data-toolstip="toolstip"]').tooltip();var a=t(".ig-popular-products #owl-example").owlCarousel({loop:!1,responsiveClass:!0,responsive:{0:{items:e,stagePadding:57,nav:!1},600:{items:e,stagePadding:57,nav:!1},768:{items:e,nav:!1},1024:{items:e,nav:!1}}});a.on("changed.owl.carousel",function(o){o.item.index>=1?t(".ig-popular-products").find(".previous").show():t(".ig-popular-products").find(".previous").hide(),o.item.index===o.item.count-e?t(".ig-popular-products").find(".next").hide():t(".ig-popular-products").find(".next").show()}),a.find(".owl-item").length<=e&&t(".ig-popular-products").find(".next").hide(),t(".ig-popular-products #owl-example > .owl-item").addClass("mz-productlist-item"),t(".ig-popular-products .next").on("click",function(){a.trigger("next.owl.carousel")}),t(".ig-popular-products .previous").on("click",function(){a.trigger("prev.owl.carousel")});var i=t(".ig-popular-products #owl-example .owl-item").length;(c.isDesktop&&i>=6||c.isTablet&&i>=3||c.isMobile&&i>=2)&&t(".ig-popular-products.carousel-parent").css("border-right","none"),this.colorSelected(),this.manageBlocksHeight()},colorSwatching:function(){t("[data-mz-swatch]").on("click",function(o){if(0===d){d=1;var a=t(o.currentTarget);a.closest(".ig-popular-products").find("input").css({border:"none"}),a.css({border:"2px solid #4a4a4a"});{var i=a.closest(".mz-productlisting").data("mz-product"),s=a.attr("value").toLowerCase(),r=a.attr("value"),n=a.closest(".mz-productlisting").find(".mz-subcategory-image").attr("data-srcset");window.location.origin}a.closest(".mz-productlisting").find(".mainImageContainer").removeClass("active"),a.closest(".mz-productlisting").find(".mainImageContainer2").addClass("active");var l=new u;l.set("filter","productCode eq "+i),l.fetch().then(function(t){var o=t.apiModel.data.items,i=null,l=null;if(e.each(o,function(t){i=e.findWhere(t.content.productImages,{altText:r||s})}),i){var c=i.imageUrl;a.closest(".mz-productlisting").find(".mz-subcategory-image").attr({srcset:c+"?max=400",alt:l,style:""}),d=0}else a.closest(".mz-productlisting").find(".mz-subcategory-image").attr({srcset:n+"?max=400",style:""}),d=0})}})},addToWishlist:function(e){e.preventDefault();var o=t(e.currentTarget).data("listing-prod-code"),a=e.currentTarget;t(a).hasClass("addedToWishlist")||t(a).addClass("clicked");n.createSync("wishlist").getOrCreate(require.mozuData("user").accountId).then(function(t){return t.data}).then(function(e){for(var s=!0,r=0;r<e.items.length;r++)e.items[r].product.productCode==o&&(s=!1);if(s){var n=new i.Product({productCode:o});n.addToWishlist({quantity:1});try{n.on("addedtowishlist",function(){t(document).trigger("productAddedToWishlist"),t(a).attr("disabled","disabled"),t(a).addClass("addedToWishlist")})}catch(l){}}})},addedToWishlist:function(){var e=[],o=[],a=0;t(".owl-item").each(function(){var i=t(this).find("a.wishlist-button"),s=t(i).data("listing-prod-code");e[a]=s,o[a]=i,a++});var i=require.mozuData("user").isAnonymous;if(i===!1){n.createSync("wishlist").getOrCreate(require.mozuData("user").accountId).then(function(t){return t.data}).then(function(a){for(var i=0;i<e.length;i++)for(var s=0;s<a.items.length;s++)a.items[s].product.productCode==e[i]&&(t(o[i]).prop("disabled","disabled"),t(o[i]).addClass("addedToWishlist"))})}},getMaxHeight:function(e){return Math.max.apply(null,t(""+e).map(function(){return t(this).height()}).get())},manageBlocksHeight:function(){try{}catch(t){}},moveTitle:function(e){t(".popular-product-container .slider-title").text(0+e),t(".popular-product-container .slider-title").removeClass("hidden")},priceFunction:function(){t(".mz-price").each(function(){var e=t(this).data("total-amount"),o=e.toString(),a=o.charAt(0),i=o.split(a),s=i[1].split("."),r=s[1];"00"==r?t(this).html('<span class="dollar">'+a+"</span>"+s[0]):t(this).html('<span class="dollar">'+a+'</span><span class="interger">'+s[0]+"</span><sup>"+s[1]+"</sup>")})}})),h=function(){var t="";t="categoryId eq "+p.title+" and tenant~popularity gt 0";var e=n.get("search",{filter:t,startIndex:0,pageSize:10,sortBy:"tenant~popularity desc"});return e},g=function(e){var o=new i.ProductCollection;o.set("items",e.data.items),0!==e.data.items.length&&t(".popular-product-container .slider-title").removeClass("hidden");var a=new m({el:t("[data-ig-popular-products]"),model:o});a.render()};h().then(function(t){g(t)}).promise["catch"](function(){var t={};t.data={},t.data.items=[],g(t)})});